---
title: "ISIS-Fish MACCO - Validation mod 3b, 2015-2018, forced recruitment"
author: "Antoine Ricouard"
date: "`r Sys.Date()`"
output: html_document
---


```{r,echo=F}
print(paste("start: ",Sys.time()))
```


# Introduction {.tabset}

This document contains the code along with the results of the skill assessment of step 3b model over the period 2015-2018. The simulations are run for four years, starting in 2015, with forced recruitment.

This document is divided into three sections (each one in a different tab). The reader mainly interested by the results will find them in the second and third section "Analysis by species" and "Analysis by fleets". 

In "Analysis by species" section, he will find a tab by species and for each species, a tab by variable. These metrics are :

* "Total catch"

* "Catch by age group by year"

* "Total landings by season"

* "Landings by year by country"

* "Landings by metier by year"

* "Landings by metier by season"

* "Total abundance"

* "Abundance by age group"

* "SSB"

* "Fishing mortality by age group"

The results consist in comparison  between observations and model simulations for these variables.


In "Analysis by fleet" section, he will find a tab for each fleet group (french smaller than 12m, french larger than 12m and foreign) and for each group, a tab by variable assessed for every fleet of the group. These variables are :

* "Total landings by species" 

* "Total landings by season"

* "Landings by metier by year"

* "Landings by metier by season"


The first section, "Preparation", is for the advanced user wanting to reproduce the analysis or to check the whole process. This user will need the source code (.Rmd file), the companion script **model_validation_fun.R** as well as observed and simulated data in the right format. There, he will find all the settings and preliminary steps required to perform the analysis, including loading of the companion script and packages, path specifications and control of data importation. 

## Preparation

Before starting, we load necessary packages and the file containing all the functions we need:
```{r setup, message=F}
knitr::opts_chunk$set(echo = TRUE)

library(data.table)
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
library(tidyr)
library(purrr, include.only = c("map_dfr"))
library(here)
library(scales)
library(RColorBrewer)
library(stringr)
library(readr)
library(forcats)

library(parallel)
library(doParallel, include.only = c("registerDoParallel")) 
library(foreach)


import::here(.from = magrittr, "%>%", extract, extract2)
import::here(.from = purrr, imap_chr, imap_dfc)


source(paste0(here(),"/R_fun/model_validation_fun.R"))

```

We have to specify a number of paths. First, the path of the observation data storage:
```{r}
obs_data_path <- paste0(here(),"/reference_data")
```

Then, the path to the simulation repositories (with simulation data):
```{r}
sim_path <- paste0(here(),"/Sim_data/raw/step3b_TF1q2/sim_valid_mod3b_2015_2018_2025-07-23-18-33")
```

The path to tidy simulation data:
```{r}
sim_tidy_path <- paste0(here(),"/Sim_data/tidy/step3b_TF1q2_all/seq_2015_2018")
```

Wether or not to save comparison datasets (obs vs. sim) and the path where to do it:
```{r}
do_I_save_comp <- T
comp_path <- paste0(here(),"/Comparison_data/step3b_TF1q2_all/seq_2015_2018")
```

For *Nephrops norvegicus* and *Merluccius merluccius*, we also need tables to convert groupisis in age beccause of the hypothesis of homogeneous accessibility by age :
```{r}
AgeLength_tables_path <- paste0(here(),"/input_data/age_length_corresp")
```

We also specify the time period on which the model is validated:
```{r}
years <- 2015:2018
```

The list of species:
```{r}
Species <- c("Solea_solea",
             "Lophius_piscatorius",
             "Lepidorhombus_whiffiagonis",
             "Raja_clavata",
             "Leucoraja_naevus",
             "Nephrops_norvegicus",
             "Merluccius_merluccius")
```

The first time, import data by transforming the raw simulated data into .rds. Once imported, no need to do it again, work only with .rds.
```{r,message=FALSE,warning=FALSE}
import_simulations <- T
if(import_simulations){
  
    for(i in seq(length(Species))){
      
      import_simu_byseason3(simu = sim_path,
                            tidy = sim_tidy_path,
                            species = Species[i],
                            years=years)
      
      import_simu_Nbyyear2(simu = sim_path,
                           tidy = sim_tidy_path,
                           species = Species[i],
                           years=years)
      
      import_simu_abundance(simu = sim_path,
                            tidy = sim_tidy_path,
                            species = Species[i],
                            years=years)
      
      import_simu_ssb(simu = sim_path,
                      tidy = sim_tidy_path,
                      species = Species[i],
                      years=years)
      
      import_simu_Fmor(simu = sim_path,
                       tidy = sim_tidy_path,
                       species = Species[i],
                       years=years)
      
    }

}

```


## Analysis by species{.tabset}
### *Solea solea* {.tabset}
```{r}
species <- "Solea solea"
spp_code <- str_replace(species," ","_")
```

Reading simulated dataset:
```{r,message=FALSE,warnings = FALSE}
Solea_sim_byseason <- read_tidysim_byseason(species = spp_code, 
                                            years = years,
                                            path = sim_tidy_path)

Solea_sim_byyear <- transform_tidy_byyear(Solea_sim_byseason)

Solea_sim_N <- read_tidysim_N(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Solea_sim_F <- read_tidysim_F(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Solea_sim_SSB <- read_tidysim_SSB(species = spp_code, 
                                  years = years,
                                  path = sim_tidy_path)

```


#### Recruitment
Preparation of data for plotting:
```{r}
Solea_data_recruit <- prep_recruit(species = spp_code,
                                   years = years,
                                   obs_data_path = obs_data_path)

```

Plotting:
```{r}
plot_recruit(Solea_data_recruit,species)
```


#### Total abundance
```{r}
metrics <- "total abundance"
```

Preparation of data for plotting:
```{r}
Solea_data_N_total <- prep_total_N(sim_data = Solea_sim_N,
                                   species = spp_code,
                                   years = years,
                                   obs_data_path = obs_data_path,
                                   export = do_I_save_comp,
                                   export_path = comp_path)

```

Plotting:
```{r}
plot_N_total(Solea_data_N_total,species)
plot_diagonal(Solea_data_N_total,species,metrics)
```



#### Abundance by age group
```{r}
metrics <- "abundance by group"
```

Preparation of data for plotting:
```{r,message=FALSE,warning=FALSE}
Solea_data_N_agegroup <- prep_N_agegroup(sim_data = Solea_sim_N,
                                         species = spp_code,
                                         years = years,
                                         obs_data_path = obs_data_path,
                                         export = do_I_save_comp,
                                         export_path = comp_path)

```

Plotting:
```{r}
Solea_plot_N_bygroup_byyear <- plot_N_agegroup(Solea_data_N_agegroup,species)
for(i in seq(length(Solea_plot_N_bygroup_byyear))){ 
  print(Solea_plot_N_bygroup_byyear[[i]])
}

plot_diagonal(Solea_data_N_agegroup,species,metrics)
```



#### SSB
```{r}
metrics <- "SSB"
```

Preparation of data for plotting:
```{r}
Solea_data_ssb <- prep_SSB(sim_data = Solea_sim_SSB,
                           species = spp_code,
                           years = years,
                           obs_data_path = obs_data_path,
                           export = do_I_save_comp,
                           export_path = comp_path)  
```

Plotting:
```{r}
plot_SSB(Solea_data_ssb,species)
plot_diagonal(Solea_data_ssb,species,metrics)
```


#### Fishing mortality by age group
```{r}
metrics <- "F by group"
``` 

Preparation of data for plotting:
```{r}
Solea_data_F_agegroup <- prep_F_agegroup(sim_data = Solea_sim_F,
                                         species = spp_code,
                                         years = years,
                                         obs_data_path = obs_data_path,
                                         export = do_I_save_comp,
                                         export_path = comp_path)

```

Plotting:
```{r}
Solea_plot_F_bygroup_byyear <- plot_F_agegroup(Solea_data_F_agegroup,species)
for(i in seq(length(Solea_plot_F_bygroup_byyear))){ 
  print(Solea_plot_F_bygroup_byyear[[i]])
}

plot_diagonal(Solea_data_F_agegroup,species,metrics)
```

#### Catch by group ISIS by year
```{r}
metrics <- "catch by group"
```

Preparation of data for plotting:
```{r,message=FALSE}
Solea_data_catch_groupisis_byyear <- prep_catch_groupisis_byyear(sim_data = Solea_sim_byyear,
                                                                 species = spp_code,
                                                                 years = years,
                                                                 obs_data_path = obs_data_path,
                                                                 export = do_I_save_comp,
                                                                 export_path = comp_path)
```

Plotting:
```{r}
Solea_plot_catch_bygroup_byyear <- plot_catch_bygroup_byyear(Solea_data_catch_groupisis_byyear,species)
for(i in seq(length(Solea_plot_catch_bygroup_byyear))){ 
  print(Solea_plot_catch_bygroup_byyear[[i]])
}

plot_diagonal(Solea_data_catch_groupisis_byyear,species,metrics)
```

#### Total landings by season 
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Solea_data_land_byseason  <- prep_land_byseason(sim_data = Solea_sim_byseason,
                                                species = spp_code,
                                                years = years,
                                                obs_data_path = obs_data_path,
                                                export = do_I_save_comp,
                                                export_path = comp_path)
```

Plotting:
```{r}
plot_land_byseason(Solea_data_land_byseason,species)
plot_diagonal(Solea_data_land_byseason,species,metrics)
```

#### Landings by year by country
```{r}
metrics <- "landings by country"
```

Here, we are interested in the proportion of each country in the landings. Absolute number can differ as observation datset are different from calibration datasets.

Preparation of data for plotting:
```{r,message=FALSE}
Solea_data_land_bycountry_byyear <- prep_land_bycountry_byyear(sim_data = Solea_sim_byyear,
                                                               species = spp_code,
                                                               years = years,
                                                               obs_data_path = obs_data_path,
                                                               export = do_I_save_comp,
                                                               export_path = comp_path)
```

Plotting:
```{r}
plot_land_bycountry_byyear(Solea_data_land_bycountry_byyear,species)
plot_diagonal(Solea_data_land_bycountry_byyear,species,metrics)
```

#### Landings by metier by year
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
Solea_data_land_bymetier_byyear <- prep_land_bymetier_byyear(sim_data = Solea_sim_byyear,
                                                             species = spp_code,
                                                             years = years,
                                                             obs_data_path = obs_data_path,
                                                             export = do_I_save_comp,
                                                             export_path = comp_path)
```

View the respective importance of each metier:
```{r}
thresh <- 0.9
Solea_metier_frequency <- metier_frequency(data = Solea_data_land_bymetier_byyear)
plot_metier_frequency(Solea_metier_frequency,thresh,species)
```

Which ones are important ? Those whose cumulative frequency is under the threshold.
```{r}
Solea_main_metiers <- main_metiers(freq_data = Solea_metier_frequency,thresh)
```

Plotting:
```{r}
Solea_plot_land_bymetier_byyear <- plot_land_bymetier_byyear(data = Solea_data_land_bymetier_byyear,
                                                             main_metier = Solea_main_metiers,
                                                             species = species)
for(i in seq(length(Solea_plot_land_bymetier_byyear))){print(Solea_plot_land_bymetier_byyear[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Solea_data_land_bymetier_byyear,species,metrics)
```

#### Landings by metier by season
```{r}
metrics <- "landings by metier by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Solea_data_land_bymetier_byseason  <- prep_land_bymetier_byseason(sim_data = Solea_sim_byseason,
                                                                  species = spp_code,
                                                                  years = years,
                                                                  obs_data_path = obs_data_path,
                                                                  export = do_I_save_comp,
                                                                  export_path = comp_path)
```

Plotting:
```{r}
Solea_plot_land_bymetier_byseason <- plot_land_bymetier_byseason(data = Solea_data_land_bymetier_byseason,
                                                                 main_metier = Solea_main_metiers,
                                                                 species = species)
for(i in seq(length(Solea_plot_land_bymetier_byseason))){print(Solea_plot_land_bymetier_byseason[[i]])}

```

Dispersion plot:
```{r}
plot_diagonal(Solea_data_land_bymetier_byseason,species,metrics)
```


#### Total catch
```{r}
metrics <- "total catch"
```

Preparation of data for plotting:
```{r}
Solea_data_catch_total_byyear <- prep_total_catch_byyear(sim_data = Solea_sim_byyear,
                                                         species = spp_code,
                                                         years = years,
                                                         obs_data_path = obs_data_path,
                                                         export = do_I_save_comp,
                                                         export_path = comp_path)
```

Plotting (bar):
```{r}
plot_catch_total_byyear(Solea_data_catch_total_byyear,species)
```

Dispersion plot:
```{r}
plot_diagonal(Solea_data_catch_total_byyear,species,metrics)
```


### *Lepidorhombus whiffiagonis* {.tabset}
```{r}
species <- "Lepidorhombus whiffiagonis"
spp_code <- str_replace(species," ","_")
```

Reading simulated dataset:
```{r,message=FALSE,warnings = FALSE}
LepiWhi_sim_byseason <- read_tidysim_byseason(species = spp_code, 
                                              years = years,
                                              path = sim_tidy_path)


LepiWhi_sim_byyear <- transform_tidy_byyear(LepiWhi_sim_byseason)

LepiWhi_sim_N <- read_tidysim_N(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

LepiWhi_sim_F <- read_tidysim_F(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

LepiWhi_sim_SSB <- read_tidysim_SSB(species = spp_code, 
                                  years = years,
                                  path = sim_tidy_path)

```

#### Recruitment
Preparation of data for plotting:
```{r}
LepiWhi_data_recruit <- prep_recruit(species = spp_code,
                                     years = years,
                                     obs_data_path = obs_data_path)

```

Plotting:
```{r}
plot_recruit(LepiWhi_data_recruit,species)
```


#### Total abundance
```{r}
metrics <- "total abundance"
```

Preparation of data for plotting:
```{r}
LepiWhi_data_N_total <- prep_total_N(sim_data = LepiWhi_sim_N,
                                   species = spp_code,
                                   years = years,
                                   obs_data_path = obs_data_path,
                                   export = do_I_save_comp,
                                   export_path = comp_path)

```

Plotting:
```{r}
plot_N_total(LepiWhi_data_N_total,species)
plot_diagonal(LepiWhi_data_N_total,species,metrics)
```

#### Abundance by age group
```{r}
metrics <- "abundance by group"
```

Preparation of data for plotting:
```{r,message=FALSE,warning=FALSE}
LepiWhi_data_N_agegroup <- prep_N_agegroup(sim_data = LepiWhi_sim_N,
                                         species = spp_code,
                                         years = years,
                                         obs_data_path = obs_data_path,
                                         export = do_I_save_comp,
                                         export_path = comp_path)

```

Plotting:
```{r}
LepiWhi_plot_N_bygroup_byyear <- plot_N_agegroup(LepiWhi_data_N_agegroup,species)
for(i in seq(length(LepiWhi_plot_N_bygroup_byyear))){ 
  print(LepiWhi_plot_N_bygroup_byyear[[i]])
}

plot_diagonal(LepiWhi_data_N_agegroup,species,metrics)
```



#### SSB
```{r}
metrics <- "SSB"
```

Preparation of data for plotting:
```{r}
LepiWhi_data_ssb <- prep_SSB(sim_data = LepiWhi_sim_SSB,
                           species = spp_code,
                           years = years,
                           obs_data_path = obs_data_path,
                           export = do_I_save_comp,
                           export_path = comp_path)
```

Plotting:
```{r}
plot_SSB(LepiWhi_data_ssb,species)
plot_diagonal(LepiWhi_data_ssb,species,metrics)
```


#### Fishing mortality by age group
```{r}
metrics <- "F by group"
``` 

Preparation of data for plotting:
```{r}
LepiWhi_data_F_agegroup <- prep_F_agegroup(sim_data = LepiWhi_sim_F,
                                         species = spp_code,
                                         years = years,
                                         obs_data_path = obs_data_path,
                                         export = do_I_save_comp,
                                         export_path = comp_path)

```

Plotting:
```{r}
LepiWhi_plot_F_bygroup_byyear <- plot_F_agegroup(LepiWhi_data_F_agegroup,species)
for(i in seq(length(LepiWhi_plot_F_bygroup_byyear))){ 
  print(LepiWhi_plot_F_bygroup_byyear[[i]])
}

plot_diagonal(LepiWhi_data_F_agegroup,species,metrics)
```


#### Catch by group ISIS by year
```{r}
metrics <- "catch by group"
```

Preparation of data for plotting:
```{r}
LepiWhi_data_catch_groupisis_byyear <- prep_catch_groupisis_byyear(sim_data = LepiWhi_sim_byyear,
                                                                   species = spp_code,
                                                                   years = years,
                                                                   obs_data_path = obs_data_path,
                                                                   export = do_I_save_comp,
                                                                   export_path = comp_path)
```


Plotting:
```{r}
LepiWhi_plot_catch_bygroup_byyear <- plot_catch_bygroup_byyear(LepiWhi_data_catch_groupisis_byyear,species)
for(i in seq(length(LepiWhi_plot_catch_bygroup_byyear))){ 
  print(LepiWhi_plot_catch_bygroup_byyear[[i]])
}

plot_diagonal(LepiWhi_data_catch_groupisis_byyear,species,metrics)
```


#### Total landings by season 
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
LepiWhi_data_land_byseason  <- prep_land_byseason(sim_data = LepiWhi_sim_byseason,
                                                  species = spp_code,
                                                  years = years,
                                                  obs_data_path = obs_data_path,
                                                  export = do_I_save_comp,
                                                  export_path = comp_path)
```

Plotting:
```{r}
plot_land_byseason(LepiWhi_data_land_byseason,species)
plot_diagonal(LepiWhi_data_land_byseason,species,metrics)
```


#### Landings by year by country
```{r}
metrics <- "landings by country"
```


Preparation of data for plotting:
```{r,message=FALSE}
LepiWhi_data_land_bycountry_byyear <- prep_land_bycountry_byyear(sim_data = LepiWhi_sim_byyear,
                                                               species = spp_code,
                                                               years = years,
                                                               obs_data_path = obs_data_path,
                                                               export = do_I_save_comp,
                                                               export_path = comp_path)
```

Plotting:
```{r}
plot_land_bycountry_byyear(LepiWhi_data_land_bycountry_byyear,species)
plot_diagonal(LepiWhi_data_land_bycountry_byyear,species,metrics)
```



#### Landings by metier by year
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
LepiWhi_data_land_bymetier_byyear <- prep_land_bymetier_byyear(sim_data = LepiWhi_sim_byyear,
                                                               species = spp_code,
                                                               years = years,
                                                               obs_data_path = obs_data_path,
                                                               export = do_I_save_comp,
                                                               export_path = comp_path)
```

View the respective importance of each metier:
```{r}
thresh <- 0.9
LepiWhi_metier_frequency <- metier_frequency(data = LepiWhi_data_land_bymetier_byyear)
plot_metier_frequency(LepiWhi_metier_frequency,thresh,species)
```

Which ones are important ? Those whose cumulative frequency is under the threshold.
```{r}
LepiWhi_main_metiers <- main_metiers(freq_data = LepiWhi_metier_frequency,thresh)
```

Plotting:
```{r}
LepiWhi_plot_land_bymetier_byyear <- plot_land_bymetier_byyear(data = LepiWhi_data_land_bymetier_byyear,
                                                             main_metier = LepiWhi_main_metiers,
                                                             species = species)
for(i in seq(length(LepiWhi_plot_land_bymetier_byyear))){print(LepiWhi_plot_land_bymetier_byyear[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(LepiWhi_data_land_bymetier_byyear,species,metrics)
```

#### Landings by metier by season
```{r}
metrics <- "landings by metier by season"
```


Preparation of data for plotting:
```{r,message=FALSE}
LepiWhi_data_land_bymetier_byseason  <- prep_land_bymetier_byseason(sim_data = LepiWhi_sim_byseason,
                                                                   species = spp_code,
                                                                   years = years,
                                                                   obs_data_path = obs_data_path,
                                                                   export = do_I_save_comp,
                                                                   export_path = comp_path)
```

Plotting:
```{r}
LepiWhi_plot_land_bymetier_byseason <- plot_land_bymetier_byseason(data = LepiWhi_data_land_bymetier_byseason,
                                                                   main_metier = LepiWhi_main_metiers,
                                                                   species = species)
for(i in seq(length(LepiWhi_plot_land_bymetier_byseason))){print(LepiWhi_plot_land_bymetier_byseason[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(LepiWhi_data_land_bymetier_byseason,species,metrics)
```


#### Total catch
```{r}
metrics <- "total catch"
```

Preparation of data for plotting:
```{r}
LepiWhi_data_catch_total_byyear <- prep_total_catch_byyear(sim_data = LepiWhi_sim_byyear,
                                                           species = spp_code,
                                                           years = years,
                                                           obs_data_path = obs_data_path,
                                                           export = do_I_save_comp,
                                                           export_path = comp_path)
```


Plotting (bar):
```{r}
plot_catch_total_byyear(LepiWhi_data_catch_total_byyear,species)
```

Dispersion plot:
```{r}
plot_diagonal(LepiWhi_data_catch_total_byyear,species,metrics)
```



### *Lophius piscatorius* {.tabset}
```{r}
species <- "Lophius piscatorius"
spp_code <- str_replace(species," ","_")
```

Reading simulated dataset:
```{r,message=FALSE,warnings = FALSE}
Lophius_sim_byseason <- read_tidysim_byseason(species = spp_code, 
                                              years = years,
                                              path = sim_tidy_path)

Lophius_sim_byyear <- transform_tidy_byyear(Lophius_sim_byseason)

Lophius_sim_N <- read_tidysim_N(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Lophius_sim_F <- read_tidysim_F(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Lophius_sim_SSB <- read_tidysim_SSB(species = spp_code, 
                                  years = years,
                                  path = sim_tidy_path)
```

#### Recruitment
Preparation of data for plotting:
```{r}
Lophius_data_recruit <- prep_recruit(species = spp_code,
                                   years = years,
                                   obs_data_path = obs_data_path)

```

Plotting:
```{r}
plot_recruit(Lophius_data_recruit,species)
```

#### Total abundance
```{r}
metrics <- "total abundance"
```

Preparation of data for plotting:
```{r}
Lophius_data_N_total <- prep_total_N(sim_data = Lophius_sim_N,
                                   species = spp_code,
                                   years = years,
                                   obs_data_path = obs_data_path,
                                   export = do_I_save_comp,
                                   export_path = comp_path)

```

Plotting:
```{r}
plot_N_total(Lophius_data_N_total,species)
plot_diagonal(Lophius_data_N_total,species,metrics)
```

#### Abundance by age group
```{r}
metrics <- "abundance by group"
```

Preparation of data for plotting:
```{r,message=FALSE,warning=FALSE}
Lophius_data_N_agegroup <- prep_N_agegroup(sim_data = Lophius_sim_N,
                                         species = spp_code,
                                         years = years,
                                         obs_data_path = obs_data_path,
                                         export = do_I_save_comp,
                                         export_path = comp_path)

```

Plotting:
```{r}
Lophius_plot_N_bygroup_byyear <- plot_N_agegroup(Lophius_data_N_agegroup,species)
for(i in seq(length(Lophius_plot_N_bygroup_byyear))){ 
  print(Lophius_plot_N_bygroup_byyear[[i]])
}

plot_diagonal(Lophius_data_N_agegroup,species,metrics)
```



#### SSB
```{r}
metrics <- "SSB"
```

Preparation of data for plotting:
```{r}
Lophius_data_ssb <- prep_SSB(sim_data = Lophius_sim_SSB,
                             species = spp_code,
                             years = years,
                             obs_data_path = obs_data_path,
                             export = do_I_save_comp,
                             export_path = comp_path)

```

Plotting:
```{r}
plot_SSB(Lophius_data_ssb,species)
plot_diagonal(Lophius_data_ssb,species,metrics)
```



#### Fishing mortality by age group
```{r}
metrics <- "F by group"
``` 

Preparation of data for plotting:
```{r}
Lophius_data_F_agegroup <- prep_F_agegroup(sim_data = Lophius_sim_F,
                                         species = spp_code,
                                         years = years,
                                         obs_data_path = obs_data_path,
                                         export = do_I_save_comp,
                                         export_path = comp_path)

```

Plotting:
```{r}
Lophius_plot_F_bygroup_byyear <- plot_F_agegroup(Lophius_data_F_agegroup,species)
for(i in seq(length(Lophius_plot_F_bygroup_byyear))){ 
  print(Lophius_plot_F_bygroup_byyear[[i]])
}

plot_diagonal(Lophius_data_F_agegroup,species,metrics)
```



#### Catch by group ISIS by year
```{r}
metrics <- "catch by group"
```

Preparation of data for plotting:
```{r}
Lophius_data_catch_groupisis_byyear <- prep_catch_groupisis_byyear(sim_data = Lophius_sim_byyear,
                                                                   species = spp_code,
                                                                   years = years,
                                                                   obs_data_path = obs_data_path,
                                                                   export = do_I_save_comp,
                                                                   export_path = comp_path)
```


Plotting:
```{r}
Lophius_plot_catch_bygroup_byyear <- plot_catch_bygroup_byyear(Lophius_data_catch_groupisis_byyear,species)
for(i in seq(length(Lophius_plot_catch_bygroup_byyear))){ 
  print(Lophius_plot_catch_bygroup_byyear[[i]])
}

plot_diagonal(Lophius_data_catch_groupisis_byyear,species,metrics)
```


#### Total landings by season 
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Lophius_data_land_byseason  <- prep_land_byseason(sim_data = Lophius_sim_byseason,
                                                species = spp_code,
                                                years = years,
                                                obs_data_path = obs_data_path,
                                                export = do_I_save_comp,
                                                export_path = comp_path)
```

Plotting:
```{r}
plot_land_byseason(Lophius_data_land_byseason,species)
plot_diagonal(Lophius_data_land_byseason,species,metrics)
```



#### Landings by year by country
```{r}
metrics <- "landings by country"
```


Preparation of data for plotting:
```{r,message=FALSE}
Lophius_data_land_bycountry_byyear <- prep_land_bycountry_byyear(sim_data = Lophius_sim_byyear,
                                                                 species = spp_code,
                                                                 years = years,
                                                                 obs_data_path = obs_data_path,
                                                                 export = do_I_save_comp,
                                                                 export_path = comp_path)
```

Plotting:
```{r}
plot_land_bycountry_byyear(Lophius_data_land_bycountry_byyear,species)
plot_diagonal(Lophius_data_land_bycountry_byyear,species,metrics)
```

#### Landings by metier by year
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
Lophius_data_land_bymetier_byyear <- prep_land_bymetier_byyear(sim_data = Lophius_sim_byyear,
                                                             species = spp_code,
                                                             years = years,
                                                             obs_data_path = obs_data_path,
                                                             export = do_I_save_comp,
                                                             export_path = comp_path)
```

View the respective importance of each metier:
```{r}
thresh <- 0.9
Lophius_metier_frequency <- metier_frequency(data = Lophius_data_land_bymetier_byyear)
plot_metier_frequency(Lophius_metier_frequency,thresh,species)
```

Which ones are important ? Those whose cumulative frequency is under the threshold.
```{r}
Lophius_main_metiers <- main_metiers(freq_data = Lophius_metier_frequency,thresh)
```

Plotting:
```{r}
Lophius_plot_land_bymetier_byyear <- plot_land_bymetier_byyear(data = Lophius_data_land_bymetier_byyear,
                                                             main_metier = Lophius_main_metiers,
                                                             species = species)
for(i in seq(length(Lophius_plot_land_bymetier_byyear))){print(Lophius_plot_land_bymetier_byyear[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Lophius_data_land_bymetier_byyear,species,metrics)
```

#### Landings by metier by season
```{r}
metrics <- "landings by metier by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Lophius_data_land_bymetier_byseason  <- prep_land_bymetier_byseason(sim_data = Lophius_sim_byseason,
                                                                   species = spp_code,
                                                                   years = years,
                                                                   obs_data_path = obs_data_path,
                                                                   export = do_I_save_comp,
                                                                   export_path = comp_path)
```

Plotting:
```{r}
Lophius_plot_land_bymetier_byseason <- plot_land_bymetier_byseason(data = Lophius_data_land_bymetier_byseason,
                                                                 main_metier = Lophius_main_metiers,
                                                                 species = species)
for(i in seq(length(Lophius_plot_land_bymetier_byseason))){print(Lophius_plot_land_bymetier_byseason[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Lophius_data_land_bymetier_byseason,species,metrics)
```


#### Total catch
```{r}
metrics <- "total catch"
```

Preparation of data for plotting:
```{r}
Lophius_data_catch_total_byyear <- prep_total_catch_byyear(sim_data = Lophius_sim_byyear,
                                                           species = spp_code,
                                                           years = years,
                                                           obs_data_path = obs_data_path,
                                                           export = do_I_save_comp,
                                                           export_path = comp_path)
```


Plotting (bar):
```{r}
plot_catch_total_byyear(Lophius_data_catch_total_byyear,species)
```

Dispersion plot:
```{r}
plot_diagonal(Lophius_data_catch_total_byyear,species,metrics)
```


### *Merluccius merluccius* {.tabset}
```{r}
species <- "Merluccius merluccius"
spp_code <- str_replace(species," ","_")
```

Reading simulated dataset:
```{r,message=FALSE,warnings = FALSE}
Merluccius_sim_byseason <- read_tidysim_byseason(species = spp_code, 
                                                 years = years,
                                                 path = sim_tidy_path)

Merluccius_sim_byyear <- transform_tidy_byyear(Merluccius_sim_byseason)

Merluccius_sim_N <- read_tidysim_N(species = spp_code, 
                                   years = years,
                                   path = sim_tidy_path)

Merluccius_sim_F <- read_tidysim_F(species = spp_code, 
                                   years = years,
                                   path = sim_tidy_path)

Merluccius_sim_SSB <- read_tidysim_SSB_merluccius(species = spp_code, 
                                                  years = years,
                                                  path = sim_tidy_path)

```

#### Recruitment
Preparation of data for plotting:
```{r}
Merluccius_data_recruit <- prep_recruit(species = spp_code,
                                   years = years,
                                   obs_data_path = obs_data_path)

```

Plotting:
```{r}
plot_recruit(Merluccius_data_recruit,species)
```

#### Total abundance
```{r}
metrics <- "total abundance"
```

Preparation of data for plotting:
```{r}
Merluccius_data_N_total <- prep_total_N(sim_data = Merluccius_sim_N,
                                        species = spp_code,
                                        years = years,
                                        obs_data_path = obs_data_path,
                                        export = do_I_save_comp,
                                        export_path = comp_path)

```

Plotting:
```{r}
plot_N_total(Merluccius_data_N_total,species)
plot_diagonal(Merluccius_data_N_total,species,metrics)
```

#### Abundance by age group
```{r}
metrics <- "abundance by group"
```

Preparation of data for plotting:
```{r,message=FALSE, warning=FALSE}
Merluccius_data_N_agegroup <- prep_N_agegroup(sim_data = Merluccius_sim_N,
                                              species = spp_code,
                                              years = years,
                                              obs_data_path = obs_data_path,
                                              export = do_I_save_comp,
                                              export_path = comp_path)
```

Plotting:
```{r}
Merluccius_plot_N_bygroup_byyear <- plot_N_agegroup_merluccius(Merluccius_data_N_agegroup,species)
for(i in seq(length(Merluccius_plot_N_bygroup_byyear))){ 
  print(Merluccius_plot_N_bygroup_byyear[[i]])
}

plot_diagonal(Merluccius_data_N_agegroup,species,metrics)
```



#### SSB
```{r}
metrics <- "SSB"
```

Preparation of data for plotting:
```{r}
Merluccius_data_ssb <- prep_SSB(sim_data = Merluccius_sim_SSB,
                                species = spp_code,
                                years = years,
                                obs_data_path = obs_data_path,
                                export = do_I_save_comp,
                                export_path = comp_path)

```

Plotting:
```{r}
plot_SSB(Merluccius_data_ssb,species)
plot_diagonal(Merluccius_data_ssb,species,metrics)
```



#### Fishing mortality by age group
```{r}
metrics <- "F by group"
``` 

Preparation of data for plotting:
```{r, eval=FALSE}
Merluccius_data_F_agegroup <- prep_F_merluccius(sim_data = Merluccius_sim_F,
                                                species = spp_code,
                                                years = years,
                                                obs_data_path = obs_data_path,
                                                export = do_I_save_comp,
                                                export_path = comp_path)

```

Plotting:
```{r,eval=FALSE}
Merluccius_plot_F_bygroup_byyear <- plot_F_agegroup(Merluccius_data_F_agegroup,species)
for(i in seq(length(Merluccius_plot_F_bygroup_byyear))){ 
  print(Merluccius_plot_F_bygroup_byyear[[i]])
}

plot_diagonal(Merluccius_data_F_agegroup,species,metrics)
```



#### Catch by age group by year
```{r}
metrics <- "catch by group"
```

Preparation of data for plotting:
```{r,message=FALSE}
Merluccius_data_catch_agegroup_byyear <- prep_catch_agegroup_byyear(sim_data = Merluccius_sim_byyear,
                                                                    species = spp_code,
                                                                    years = years,
                                                                    obs_data_path = obs_data_path,
                                                                    corresp_path = AgeLength_tables_path,
                                                                    export = do_I_save_comp,
                                                                    export_path = comp_path)
```

Plotting:
```{r}
plot_catch_byage_merluccius(Merluccius_data_catch_agegroup_byyear)
plot_diagonal(Merluccius_data_catch_agegroup_byyear,species,metrics)
```


#### Total landings by season 
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Merluccius_data_land_byseason  <- prep_land_byseason(sim_data = Merluccius_sim_byseason,
                                                     species = spp_code,
                                                     years = years,
                                                     obs_data_path = obs_data_path,
                                                     export = do_I_save_comp,
                                                     export_path = comp_path)
```

Plotting:
```{r}
plot_land_byseason(Merluccius_data_land_byseason,species)
plot_diagonal(Merluccius_data_land_byseason,species,metrics)
```



#### Landings by year by country
```{r}
metrics <- "landings by country"
```

Preparation of data for plotting:
```{r,message=FALSE}
Merluccius_data_land_bycountry_byyear <- prep_land_bycountry_byyear(sim_data = Merluccius_sim_byyear,
                                                                    species = spp_code,
                                                                    years = years,
                                                                    obs_data_path = obs_data_path,
                                                                    export = do_I_save_comp,
                                                                    export_path = comp_path)
```

Plotting:
```{r}
plot_land_bycountry_byyear(Merluccius_data_land_bycountry_byyear,species)
plot_diagonal(Merluccius_data_land_bycountry_byyear,species,metrics)
```



#### Landings by metier by year
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
Merluccius_data_land_bymetier_byyear <- prep_land_bymetier_byyear(sim_data = Merluccius_sim_byyear,
                                                             species = spp_code,
                                                             years = years,
                                                             obs_data_path = obs_data_path,
                                                             export = do_I_save_comp,
                                                             export_path = comp_path)
```

View the respective importance of each metier:
```{r}
thresh <- 0.9
Merluccius_metier_frequency <- metier_frequency(data = Merluccius_data_land_bymetier_byyear)
plot_metier_frequency(Merluccius_metier_frequency,thresh,species)
```

Which ones are important ? Those whose cumulative frequency is under the threshold.
```{r}
Merluccius_main_metiers <- main_metiers(freq_data = Merluccius_metier_frequency,thresh)
```

Plotting:
```{r}
Merluccius_plot_land_bymetier_byyear <- plot_land_bymetier_byyear(data = Merluccius_data_land_bymetier_byyear,
                                                             main_metier = Merluccius_main_metiers,
                                                             species = species)
for(i in seq(length(Merluccius_plot_land_bymetier_byyear))){print(Merluccius_plot_land_bymetier_byyear[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Merluccius_data_land_bymetier_byyear,species,metrics)
```


#### Landings by metier by season
```{r}
metrics <- "landings by metier by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Merluccius_data_land_bymetier_byseason  <- prep_land_bymetier_byseason(sim_data = Merluccius_sim_byseason,
                                                                       species = spp_code,
                                                                       years = years,
                                                                       obs_data_path = obs_data_path,
                                                                       export = do_I_save_comp,
                                                                       export_path = comp_path)
```

Plotting:
```{r}
Merluccius_plot_land_bymetier_byseason <- plot_land_bymetier_byseason(data = Merluccius_data_land_bymetier_byseason,
                                                                      main_metier = Merluccius_main_metiers,
                                                                      species = species)
for(i in seq(length(Merluccius_plot_land_bymetier_byseason))){print(Merluccius_plot_land_bymetier_byseason[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Merluccius_data_land_bymetier_byseason,species,metrics)
```


#### Total catch
```{r}
metrics <- "total catch"
```

Preparation of data for plotting:
```{r}
Merluccius_data_catch_total_byyear <- prep_total_catch_byyear(sim_data = Merluccius_sim_byyear,
                                                              species = spp_code,
                                                              years = years,
                                                              obs_data_path = obs_data_path,
                                                              export = do_I_save_comp,
                                                              export_path = comp_path)
```


Plotting (bar):
```{r}
plot_catch_total_byyear(Merluccius_data_catch_total_byyear,species)
```

Dispersion plot:
```{r}
plot_diagonal(Merluccius_data_catch_total_byyear,species,metrics)
```

Preparation of catch data with TAC:
```{r,eval=FALSE}
Merluccius_data_catch_and_TAC <- prep_catch_and_TAC(catch_data = Merluccius_data_catch_total_byyear,
                                               TAC_data = TAC_data,
                                               country_data = Merluccius_data_land_bycountry_byyear,
                                               species = spp_code,
                                               years = years)
```

Plotting (line, with TAC):
```{r,eval=FALSE}
plot_catch_and_TAC(Merluccius_data_catch_and_TAC,display_TAC=F)
```



### *Raja clavata* {.tabset}
```{r}
species <- "Raja clavata"
spp_code <- str_replace(species," ","_")
years_2 <- years[years!=2022]
```

Reading simulated dataset:
```{r,message=FALSE,warnings = FALSE}
Raja_sim_byseason <- read_tidysim_byseason(species = spp_code, 
                                           years = years,
                                           path = sim_tidy_path)

Raja_sim_byyear <- transform_tidy_byyear(Raja_sim_byseason)

Raja_sim_N <- read_tidysim_N(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Raja_sim_F <- read_tidysim_F(species = spp_code, 
                             years = years,
                             path = sim_tidy_path)

Raja_sim_SSB <- read_tidysim_SSB(species = spp_code, 
                                  years = years,
                                  path = sim_tidy_path)

```


#### Total abundance
```{r}
metrics <- "total abundance"
```

Preparation of data for plotting:
```{r}
Raja_data_N_total <- prep_total_N(sim_data = Raja_sim_N,
                                  species = spp_code,
                                  years = years_2,
                                  obs_data_path = obs_data_path,
                                  export = do_I_save_comp,
                                  export_path = comp_path)

```

Plotting:
```{r}
plot_N_total(Raja_data_N_total,species)
plot_diagonal(Raja_data_N_total,species,metrics)
```


#### SSB
```{r}
metrics <- "SSB"
```

Preparation of data for plotting:
```{r,eval=T}
Raja_data_ssb <- prep_SSB(sim_data = Raja_sim_SSB,
                          species = spp_code,
                          years = years_2,
                          obs_data_path = obs_data_path,
                          export = do_I_save_comp,
                          export_path = comp_path)

```

Plotting:
```{r}
plot_SSB(Raja_data_ssb,species)
plot_diagonal(Raja_data_ssb,species,metrics)
```




#### Fishing mortality
```{r}
metrics <- "F"
``` 

Preparation of data for plotting:
```{r}
Raja_data_F_agegroup <- prep_F_agegroup(sim_data = Raja_sim_F,
                                        species = spp_code,
                                        years = years_2,
                                        obs_data_path = obs_data_path,
                                        export = do_I_save_comp,
                                        export_path = comp_path)

```

Plotting:
```{r}
Raja_plot_F_bygroup_byyear <- plot_F_agegroup(Raja_data_F_agegroup,species)
for(i in seq(length(Raja_plot_F_bygroup_byyear))){ 
  print(Raja_plot_F_bygroup_byyear[[i]])
}

plot_diagonal(Raja_data_F_agegroup,species,metrics)
```



#### Total landings by season 
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Raja_data_land_byseason  <- prep_land_byseason(sim_data = Raja_sim_byseason,
                                               species = spp_code,
                                               years = years,
                                               obs_data_path = obs_data_path,
                                               export = do_I_save_comp,
                                               export_path = comp_path)
```

Plotting:
```{r}
plot_land_byseason(Raja_data_land_byseason,species)
plot_diagonal(Raja_data_land_byseason,species,metrics)
```


#### Landings by year by country
```{r}
metrics <- "landings by country"
```

Preparation of data for plotting:
```{r,message=FALSE}
Raja_data_land_bycountry_byyear <- prep_land_bycountry_byyear(sim_data = Raja_sim_byyear,
                                                              species = spp_code,
                                                              years = years,
                                                              obs_data_path = obs_data_path,
                                                              export = do_I_save_comp,
                                                              export_path = comp_path)
```

Plotting:
```{r,eval=T}
plot_land_bycountry_byyear(Raja_data_land_bycountry_byyear,species)
plot_diagonal(Raja_data_land_bycountry_byyear,species,metrics)
```


#### Landings by metier by year
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
Raja_data_land_bymetier_byyear <- prep_land_bymetier_byyear(sim_data = Raja_sim_byyear,
                                                            species = spp_code,
                                                            years = years,
                                                            obs_data_path = obs_data_path,
                                                            export = do_I_save_comp,
                                                            export_path = comp_path)
```

View the respective importance of each metier:
```{r}
thresh <- 0.9
Raja_metier_frequency <- metier_frequency(data = Raja_data_land_bymetier_byyear)
plot_metier_frequency(Raja_metier_frequency,thresh,species)
```

Which ones are important ? Those whose cumulative frequency is under the threshold.
```{r}
Raja_main_metiers <- main_metiers(freq_data = Raja_metier_frequency,thresh)
```

Plotting:
```{r}
Raja_plot_land_bymetier_byyear <- plot_land_bymetier_byyear(data = Raja_data_land_bymetier_byyear,
                                                             main_metier = Raja_main_metiers,
                                                             species = species)
for(i in seq(length(Raja_plot_land_bymetier_byyear))){print(Raja_plot_land_bymetier_byyear[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Raja_data_land_bymetier_byyear,species,metrics)
```

#### Landings by metier by season
```{r}
metrics <- "landings by metier by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Raja_data_land_bymetier_byseason  <- prep_land_bymetier_byseason(sim_data = Raja_sim_byseason,
                                                                 species = spp_code,
                                                                 years = years,
                                                                 obs_data_path = obs_data_path,
                                                                 export = do_I_save_comp,
                                                                 export_path = comp_path)
```

Plotting:
```{r}
Raja_plot_land_bymetier_byseason <- plot_land_bymetier_byseason(data = Raja_data_land_bymetier_byseason,
                                                                 main_metier = Raja_main_metiers,
                                                                 species = species)
for(i in seq(length(Raja_plot_land_bymetier_byseason))){print(Raja_plot_land_bymetier_byseason[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Raja_data_land_bymetier_byseason,species,metrics)
```



#### Total catch
```{r}
metrics <- "total catch"
```

Preparation of data for plotting:
```{r}
Raja_data_catch_total_byyear <- prep_total_land_byyear(sim_data = Raja_sim_byyear,
                                                       species = spp_code,
                                                       years = years_2,
                                                       obs_data_path = obs_data_path,
                                                       export = do_I_save_comp,
                                                       export_path = comp_path)
```

Plotting (bar):
```{r}
plot_catch_total_byyear(Raja_data_catch_total_byyear,species)
```

Dispersion plot:
```{r}
plot_diagonal(Raja_data_catch_total_byyear,species,metrics)
```

Preparation of catch data with TAC:
```{r,eval=FALSE}
Raja_data_catch_and_TAC <- prep_catch_and_TAC(catch_data = Raja_data_catch_total_byyear,
                                               TAC_data = TAC_data,
                                              country_data = Raja_data_land_bycountry_byyear,
                                               species = spp_code,
                                               years = years_2)
```

Plotting (line, with TAC):
```{r,eval=FALSE}
plot_catch_and_TAC(Raja_data_catch_and_TAC,display_TAC=F)
```



### *Leucoraja naevus* {.tabset}

```{r}
species <- "Leucoraja naevus"
spp_code <- str_replace(species," ","_")
```

Reading simulated dataset:
```{r,message=FALSE,warnings = FALSE}
Leucoraja_sim_byseason <- read_tidysim_byseason(species = spp_code, 
                                                years = years,
                                                path = sim_tidy_path)

Leucoraja_sim_byyear <- transform_tidy_byyear(Leucoraja_sim_byseason)

Leucoraja_sim_N <- read_tidysim_N(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Leucoraja_sim_F <- read_tidysim_F(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Leucoraja_sim_SSB <- read_tidysim_SSB(species = spp_code, 
                                  years = years,
                                  path = sim_tidy_path)

```

#### Total abundance
```{r}
metrics <- "total abundance"
```

Preparation of data for plotting:
```{r}
Leucoraja_data_N_total <- prep_total_N(sim_data = Leucoraja_sim_N,
                                       species = spp_code,
                                       years = years,
                                       obs_data_path = obs_data_path,
                                       export = do_I_save_comp,
                                       export_path = comp_path)

```

Plotting:
```{r}
plot_N_total(Leucoraja_data_N_total,species)
plot_diagonal(Leucoraja_data_N_total,species,metrics)
```


#### SSB
Preparation of data for plotting:
```{r,eval=T}
Leucoraja_data_ssb <- prep_SSB(sim_data = Leucoraja_sim_SSB,
                               species = spp_code,
                               years = years_2,
                               obs_data_path = obs_data_path,
                               export = do_I_save_comp,
                               export_path = comp_path)

```

Plotting:
```{r}
plot_SSB(Leucoraja_data_ssb,species)
plot_diagonal(Leucoraja_data_ssb,species,metrics)
```



#### Fishing mortality
```{r}
metrics <- "F by group"
``` 

Preparation of data for plotting:
```{r}
Leucoraja_data_F_agegroup <- prep_F_agegroup(sim_data = Leucoraja_sim_F,
                                             species = spp_code,
                                             years = years_2,
                                             obs_data_path = obs_data_path,
                                             export = do_I_save_comp,
                                             export_path = comp_path)

```

Plotting:
```{r}
Leucoraja_plot_F_bygroup_byyear <- plot_F_agegroup(Leucoraja_data_F_agegroup,species)
for(i in seq(length(Leucoraja_plot_F_bygroup_byyear))){ 
  print(Leucoraja_plot_F_bygroup_byyear[[i]])
}

plot_diagonal(Leucoraja_data_F_agegroup,species,metrics)
```




#### Total landings by season 
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Leucoraja_data_land_byseason  <- prep_land_byseason(sim_data = Leucoraja_sim_byseason,
                                                    species = spp_code,
                                                    years = years,
                                                    obs_data_path = obs_data_path,
                                                    export = do_I_save_comp,
                                                    export_path = comp_path)
```

Plotting:
```{r}
plot_land_byseason(Leucoraja_data_land_byseason,species)
plot_diagonal(Leucoraja_data_land_byseason,species,metrics)
```



#### Landings by year by country
```{r}
metrics <- "landings by country"
```


Preparation of data for plotting:
```{r,message=FALSE}
Leucoraja_data_land_bycountry_byyear <- prep_land_bycountry_byyear(sim_data = Leucoraja_sim_byyear,
                                                                   species = spp_code,
                                                                   years = years,
                                                                   obs_data_path = obs_data_path,
                                                                   export = do_I_save_comp,
                                                                   export_path = comp_path)
```

Plotting:
```{r, eval=T}
plot_land_bycountry_byyear(Leucoraja_data_land_bycountry_byyear,species)
plot_diagonal(Leucoraja_data_land_bycountry_byyear,species,metrics)
```


#### Landings by metier by year
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
Leucoraja_data_land_bymetier_byyear <- prep_land_bymetier_byyear(sim_data = Leucoraja_sim_byyear,
                                                             species = spp_code,
                                                             years = years,
                                                             obs_data_path = obs_data_path,
                                                             export = do_I_save_comp,
                                                             export_path = comp_path)
```

View the respective importance of each metier:
```{r}
thresh <- 0.9
Leucoraja_metier_frequency <- metier_frequency(data = Leucoraja_data_land_bymetier_byyear)
plot_metier_frequency(Leucoraja_metier_frequency,thresh,species)
```

Which ones are important ? Those whose cumulative frequency is under the threshold.
```{r}
Leucoraja_main_metiers <- main_metiers(freq_data = Leucoraja_metier_frequency,thresh)
```

Plotting:
```{r}
Leucoraja_plot_land_bymetier_byyear <- plot_land_bymetier_byyear(data = Leucoraja_data_land_bymetier_byyear,
                                                             main_metier = Leucoraja_main_metiers,
                                                             species = species)
for(i in seq(length(Leucoraja_plot_land_bymetier_byyear))){print(Leucoraja_plot_land_bymetier_byyear[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Raja_data_land_bymetier_byyear,species,metrics)
```

#### Landings by metier by season
```{r}
metrics <- "landings by metier by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Leucoraja_data_land_bymetier_byseason  <- prep_land_bymetier_byseason(sim_data = Leucoraja_sim_byseason,
                                                                      species = spp_code,
                                                                      years = years,
                                                                      obs_data_path = obs_data_path,
                                                                      export = do_I_save_comp,
                                                                      export_path = comp_path)
```

Plotting:
```{r}
Leucoraja_plot_land_bymetier_byseason <- plot_land_bymetier_byseason(data = Leucoraja_data_land_bymetier_byseason,
                                                                     main_metier = Leucoraja_main_metiers,
                                                                     species = species)
for(i in seq(length(Leucoraja_plot_land_bymetier_byseason))){print(Leucoraja_plot_land_bymetier_byseason[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Leucoraja_data_land_bymetier_byseason,species,metrics)
```


#### Total catch
```{r}
metrics <- "total catch"
```

Preparation of data for plotting:
```{r,eval=T}
Leucoraja_data_catch_total_byyear <- prep_total_land_byyear(sim_data = Leucoraja_sim_byyear,
                                                            species = spp_code,
                                                            years = years_2,
                                                            obs_data_path = obs_data_path,
                                                            export = do_I_save_comp,
                                                            export_path = comp_path)
```

Plotting (bar):
```{r}
plot_catch_total_byyear(Leucoraja_data_catch_total_byyear,species)
```

Dispersion plot:
```{r}
plot_diagonal(Leucoraja_data_catch_total_byyear,species,metrics)
```




### *Nephrops norvegicus* {.tabset}
```{r}
species <- "Nephrops norvegicus"
spp_code <- str_replace(species," ","_")
```

Reading simulated dataset:
```{r, message=FALSE,warnings = FALSE}
Nephrops_sim_byseason <- read_tidysim_byseason(species = spp_code, 
                                               years = years,
                                               path = sim_tidy_path)

Nephrops_sim_byyear <- transform_tidy_byyear(Nephrops_sim_byseason)

Nephrops_sim_catchN <- read_tidysim_catchN(species = spp_code, 
                                           years = years,
                                           path = sim_tidy_path)

Nephrops_sim_N <- read_tidysim_N(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Nephrops_sim_F <- read_tidysim_F(species = spp_code, 
                              years = years,
                              path = sim_tidy_path)

Nephrops_sim_SSB <- read_tidysim_SSB(species = spp_code, 
                                  years = years,
                                  path = sim_tidy_path)


```

#### Recruitment
Preparation of data for plotting:
```{r}
Nephrops_data_recruit <- prep_recruit_sim(species = spp_code,
                                          years = years,
                                          sim_data_path = sim_tidy_path)

```

Plotting:
```{r}
plot_recruit(Nephrops_data_recruit,species)
```

#### Total catch
```{r}
metrics <- "total catch"
```

Preparation of data for plotting:
```{r,message=FALSE}
Nephrops_data_catch_total_byyear <- prep_total_catchN_byyear(sim_data = Nephrops_sim_catchN,
                                                             species = spp_code,
                                                             years = years,
                                                             obs_data_path = obs_data_path,
                                                             export = do_I_save_comp,
                                                             export_path = comp_path)
```


Plotting:
```{r}
plot_catchN_total_byyear(Nephrops_data_catch_total_byyear,species)
plot_diagonal(Nephrops_data_catch_total_byyear,species,metrics)
```


#### Catch by group ISIS by year
```{r}
metrics <- "catch by group"
```

Preparation of data for plotting:
```{r,message=FALSE}
Nephrops_data_catchN_agegroup_byyear <- prep_catchN_agegroup_byyear(sim_data = Nephrops_sim_catchN,
                                                                    species = spp_code,
                                                                    years = years,
                                                                    obs_data_path = obs_data_path,
                                                                    corresp_path = AgeLength_tables_path,
                                                                    export = do_I_save_comp,
                                                                    export_path = comp_path)
```


Plotting:
```{r,message=FALSE}
Nephrops_plot_catchN_agegroup_byyear <- plot_catch_byage_nephrops(Nephrops_data_catchN_agegroup_byyear) 
print(Nephrops_plot_catchN_agegroup_byyear[[1]])
print(Nephrops_plot_catchN_agegroup_byyear[[2]])

plot_diagonal(Nephrops_data_catchN_agegroup_byyear,species,metrics)
```


#### Total landings by season 
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
Nephrops_data_land_byseason  <- prep_land_byseason(sim_data = Nephrops_sim_byseason,
                                                   species = spp_code,
                                                   years = years,
                                                   obs_data_path = obs_data_path,
                                                   export = do_I_save_comp,
                                                   export_path = comp_path)
```

Plotting:
```{r}
plot_land_byseason(Nephrops_data_land_byseason,species)
plot_diagonal(Nephrops_data_land_byseason,species,metrics)
```


#### Landings by year by country
```{r}
metrics <- "landings by country"
```

Preparation of data for plotting:
```{r,message=FALSE}
Nephrops_data_land_bycountry_byyear <- prep_land_bycountry_byyear(sim_data = Nephrops_sim_byyear,
                                                                  species = spp_code,
                                                                  years = years,
                                                                  obs_data_path = obs_data_path,
                                                                  export = do_I_save_comp,
                                                                  export_path = comp_path)
```

Plotting:
```{r}
plot_land_bycountry_byyear(Nephrops_data_land_bycountry_byyear,species)
plot_diagonal(Nephrops_data_land_bycountry_byyear,species,metrics)
```



#### Landings by metier by year
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:

```{r,message=FALSE}
Nephrops_data_land_bymetier_byyear <- prep_land_bymetier_byyear(sim_data = Nephrops_sim_byyear,
                                                                species = spp_code,
                                                                years = years,
                                                                obs_data_path = obs_data_path,
                                                                export = do_I_save_comp,
                                                                export_path = comp_path)
```

View the respective importance of each metier:
```{r}
thresh <- 0.9
Nephrops_metier_frequency <- metier_frequency(data = Nephrops_data_land_bymetier_byyear)
plot_metier_frequency(Nephrops_metier_frequency,thresh,species)
```

Which ones are important ? Those whose cumulative frequency is under the threshold.
```{r}
Nephrops_main_metiers <- main_metiers(freq_data = Nephrops_metier_frequency,thresh)
```

Plotting:
```{r,eval=FALSE}
Nephrops_plot_land_bymetier_byyear <- plot_land_bymetier_byyear(data = Nephrops_data_land_bymetier_byyear,
                                                                main_metier = Nephrops_main_metiers,
                                                                species = species)
for(i in seq(length(Nephrops_plot_land_bymetier_byyear))){print(Nephrops_plot_land_bymetier_byyear[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Nephrops_data_land_bymetier_byyear,species,metrics)
```

#### Landings by metier by season
Preparation of data for plotting:
```{r,message=FALSE}
Nephrops_data_land_bymetier_byseason  <- prep_land_bymetier_byseason(sim_data = Nephrops_sim_byseason,
                                                                     species = spp_code,
                                                                     years = years,
                                                                     obs_data_path = obs_data_path,
                                                                     export = do_I_save_comp,
                                                                     export_path = comp_path)
```

Plotting:
```{r,eval=FALSE}
Nephrops_plot_land_bymetier_byseason <- plot_land_bymetier_byseason(data = Nephrops_data_land_bymetier_byseason,
                                                                    main_metier = Nephrops_main_metiers,
                                                                    species = species)
for(i in seq(length(Nephrops_plot_land_bymetier_byseason))){print(Nephrops_plot_land_bymetier_byseason[[i]])}
```

Dispersion plot:
```{r}
plot_diagonal(Nephrops_data_land_bymetier_byseason,species,metrics)
```




## Analysis by fleets {.tabset}

Reading simulated dataset:
```{r,message=FALSE}
data_all <- read_tidysim_byfleet_byseason(species = Species,
                                          years = years,
                                          path = sim_tidy_path)
``` 

### FR < 12m {.tabset}
```{r}
fgroup <- 'inf12'
data_fleet <- data_all %>% filter(fleet_group == fgroup)
fleets <- unique(data_fleet$fleet)
```

#### Total landings by year{.tabset}
```{r}
metrics <- "total landings"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byfleet_byyear(sim_data = data_fleet,
                                 obs_data_path = obs_data_path,
                                 fleet_group = fgroup,
                                 years = years,
                                 export = do_I_save_comp,
                                 export_path = comp_path)
```

##### Dispersion plots by fleet:

```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
plot_land_byfleet_byyear(data)
```

#### Total landings by season{.tabset}
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byfleet_byseason(sim_data = data_fleet,
                                   obs_data_path = obs_data_path,
                                   fleet_group = fgroup,
                                   years = years,
                                   export = do_I_save_comp,
                                   export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
plot_land_byfleet_byseason(data)
```

#### Landings by species by year{.tabset}
```{r}
metrics <- "landings by species"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byspecies_byfleet_byyear(sim_data = data_fleet,
                                           obs_data_path = obs_data_path,
                                           fleet_group = fgroup,
                                           years = years,
                                           export = do_I_save_comp,
                                           export_path = comp_path)
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_byspecies_byfleet_byyear(this_data,this_fleet))}
}
```

##### Dispersion by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,metrics,this_fleet))}
}
```

#### Landings by species by season{.tabset}
```{r}
metrics <- "landings by species by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byspecies_byfleet_byseason(sim_data = data_fleet,
                                             obs_data_path = obs_data_path,
                                             fleet_group = fgroup,
                                             years = years,
                                             export = do_I_save_comp,
                                             export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_byspecies_byfleet_byseason(this_data,this_fleet))}
}
```

#### Landings by metier by year{.tabset}
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_bymetier_byfleet_byyear(sim_data = data_fleet,
                                          obs_data_path = obs_data_path,
                                          fleet_group = fgroup,
                                          years = years,
                                          export = do_I_save_comp,
                                          export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_bymetier_byfleet_byyear(this_data))}
}
```


#### Landings by metier by season{.tabset}
```{r}
metrics <- "landings by metier by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_bymetier_byfleet_byseason(sim_data = data_fleet,
                                            obs_data_path = obs_data_path,
                                            fleet_group = fgroup,
                                            years = years,
                                            export = do_I_save_comp,
                                            export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_bymetier_byfleet_byseason(this_data))}
}
```


### FR > 12m {.tabset}
```{r}
fgroup <- 'sup12'
data_fleet <- data_all %>% filter(fleet_group == fgroup)
fleets <- unique(data_fleet$fleet)
```


#### Total landings by year{.tabset}
```{r}
metrics <- "total landings"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byfleet_byyear(sim_data = data_fleet,
                                 obs_data_path = obs_data_path,
                                 fleet_group = fgroup,
                                 years = years,
                                 export = do_I_save_comp,
                                 export_path = comp_path)
```

##### Dispersion plots by fleet:

```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
plot_land_byfleet_byyear(data)
```

#### Total landings by season
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byfleet_byseason(sim_data = data_fleet,
                                   obs_data_path = obs_data_path,
                                   fleet_group = fgroup,
                                   years = years,
                                   export = do_I_save_comp,
                                   export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
plot_land_byfleet_byseason(data)
```

#### Landings by species by year{.tabset}
```{r}
metrics <- "landings by species"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byspecies_byfleet_byyear(sim_data = data_fleet,
                                           obs_data_path = obs_data_path,
                                           fleet_group = fgroup,
                                           years = years,
                                           export = do_I_save_comp,
                                           export_path = comp_path)
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_byspecies_byfleet_byyear(this_data,this_fleet))}
}
```

##### Dispersion by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,metrics,this_fleet))}
}
```

#### Landings by species by season{.tabset}
```{r}
metrics <- "landings by species by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byspecies_byfleet_byseason(sim_data = data_fleet,
                                             obs_data_path = obs_data_path,
                                             fleet_group = fgroup,
                                             years = years,
                                             export = do_I_save_comp,
                                             export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_byspecies_byfleet_byseason(this_data,this_fleet))}
}
```

#### Landings by metier by year{.tabset}
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_bymetier_byfleet_byyear(sim_data = data_fleet,
                                          obs_data_path = obs_data_path,
                                          fleet_group = fgroup,
                                          years = years,
                                          export = do_I_save_comp,
                                          export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_bymetier_byfleet_byyear(this_data))}
}
```


#### Landings by metier by season{.tabset}
```{r}
metrics <- "landings by metier by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_bymetier_byfleet_byseason(sim_data = data_fleet,
                                            obs_data_path = obs_data_path,
                                            fleet_group = fgroup,
                                            years = years,
                                            export = do_I_save_comp,
                                            export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_bymetier_byfleet_byseason(this_data))}
}
```


### Foreign {.tabset}
```{r}
fgroup <- 'foreign'
data_fleet <- data_all %>% filter(fleet_group == fgroup)
fleets <- unique(data_fleet$fleet)
```

#### Total landings by year{.tabset}
```{r}
metrics <- "total landings"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byfleet_byyear(sim_data = data_fleet,
                                 obs_data_path = obs_data_path,
                                 fleet_group = fgroup,
                                 years = years,
                                 export = do_I_save_comp,
                                 export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
plot_land_byfleet_byyear(data)
```

#### Total landings by season{.tabset}
```{r}
metrics <- "landings by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byfleet_byseason(sim_data = data_fleet,
                                   obs_data_path = obs_data_path,
                                   fleet_group = fgroup,
                                   years = years,
                                   export = do_I_save_comp,
                                   export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
plot_land_byfleet_byseason(data)
```

#### Landings by species by year {.tabset}
```{r}
metrics <- "landings by species"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byspecies_byfleet_byyear(sim_data = data_fleet,
                                           obs_data_path = obs_data_path,
                                           fleet_group = fgroup,
                                           years = years,
                                           export = do_I_save_comp,
                                           export_path = comp_path)
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_byspecies_byfleet_byyear(this_data,this_fleet))}
}
```

##### Dispersion by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,metrics,this_fleet))}
}
```

#### Landings by species by season {.tabset}
```{r}
metrics <- "landings by species by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_byspecies_byfleet_byseason(sim_data = data_fleet,
                                             obs_data_path = obs_data_path,
                                             fleet_group = fgroup,
                                             years = years,
                                             export = do_I_save_comp,
                                             export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_byspecies_byfleet_byseason(this_data,this_fleet))}
}
```

#### Landings by metier by year {.tabset}
```{r}
metrics <- "landings by metier"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_bymetier_byfleet_byyear(sim_data = data_fleet,
                                          obs_data_path = obs_data_path,
                                          fleet_group = fgroup,
                                          years = years,
                                          export = do_I_save_comp,
                                          export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_bymetier_byfleet_byyear(this_data))}
}
```


#### Landings by metier by season {.tabset}
```{r}
metrics <- "landings by metier by season"
```

Preparation of data for plotting:
```{r,message=FALSE}
data <- prep_land_bymetier_byfleet_byseason(sim_data = data_fleet,
                                            obs_data_path = obs_data_path,
                                            fleet_group = fgroup,
                                            years = years,
                                            export = do_I_save_comp,
                                            export_path = comp_path)
```

##### Dispersion plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_diagonal(this_data,this_fleet,metrics))}
}
```

##### Series plots by fleet:
```{r}
for(i in seq(length(fleets))){
  this_fleet <- fleets[i]
  this_data <- data %>% filter(fleet_isis == this_fleet)
  if(nrow(this_data)>0){print(plot_land_bymetier_byfleet_byseason(this_data))}
}
```



# .
```{r,echo=F}
print(paste("end: ",Sys.time()))
```

